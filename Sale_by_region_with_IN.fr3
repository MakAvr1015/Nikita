<?xml version="1.0" encoding="utf-8" standalone="no"?>
<TfrxReport Version="6.0.7" DotMatrixReport="False" EngineOptions.PrintIfEmpty="False" IniFile="\Software\Fast Reports" PreviewOptions.AllowEdit="False" PreviewOptions.Buttons="4095" PreviewOptions.ShowCaptions="True" PreviewOptions.Zoom="1" PreviewOptions.ZoomMode="zmWholePage" PrintOptions.Printer="Default" PrintOptions.PrintOnSheet="0" ReportOptions.CreateDate="40519,6491639468" ReportOptions.Description.Text="" ReportOptions.Name="Продажи за период по регионам (со вход.ценами)" ReportOptions.LastChange="43426,3429032639" ScriptLanguage="PascalScript" ScriptText.Text="procedure DialogPage1OnShow(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  DtStart.date:=date;&#13;&#10;  DtEnd.date:=date;&#13;&#10;  DsPostav.Active:=true;&#13;&#10;  DsPostav.last;&#13;&#10;  LkpPost.KeyValue:=-1;&#13;&#10;end;&#13;&#10;&#13;&#10;procedure Button1OnClick(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  Report.Variables.Variables['st_date']:=Dtstart.Date;&#13;&#10;  Report.Variables.Variables['ed_date']:=Dtend.Date;&#13;&#10;  Report.Variables.Variables['f_post']:=LkpPost.KeyValue;&#13;&#10;  Report.Variables.Variables['hide_info']:=CheckHide.Checked;&#13;&#10;end;&#13;&#10;&#13;&#10;begin&#13;&#10;&#13;&#10;end.">
  <Datasets>
    <item DataSet="FIBQuery1" DataSetName="dsResult"/>
    <item DataSet="dsPostav" DataSetName="dsPostav"/>
  </Datasets>
  <Variables>
    <item Name="TFrmNsiPartner"/>
    <item Name="F_ID"/>
    <item Name="F_NAME"/>
    <item Name="F_U_NAME"/>
    <item Name="F_U_ADDRES"/>
    <item Name="F_INN"/>
    <item Name="F_KPP"/>
    <item Name=" Local"/>
    <item Name="st_date"/>
    <item Name="ed_date"/>
    <item Name="f_post"/>
    <item Name="hide_info"/>
  </Variables>
  <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000">
    <TfrxFIBQuery Name="dsPostav" UserName="dsPostav" CloseDataSource="True" FieldAliases.Text="" BCDToCurrency="False" IgnoreDupParams="False" SQL.Text="select *&#13;&#10;from&#13;&#10;(&#13;&#10;select&#13;&#10;  f_partner as grp_id,&#13;&#10;  (select f_name from sp_t_nsi_partner_get(f_partner)) as f_name&#13;&#10;from&#13;&#10; t_nsi_goods&#13;&#10;where f_partner is not null&#13;&#10;group by f_partner&#13;&#10;union&#13;&#10;select -1,'Все' from rdb$database&#13;&#10;)&#13;&#10;order by grp_id" PropData="05704C656674023C0470546F7002140A506172616D65746572730100"/>
    <TfrxFIBQuery Name="FIBQuery1" UserName="dsResult" CloseDataSource="True" FieldAliases.Text="" BCDToCurrency="False" IgnoreDupParams="False" SQL.Text="select&#13;&#10;  p.f_id,&#13;&#10;  p.f_name,&#13;&#10;  p.f_u_addres,&#13;&#10;  d.f_sum,&#13;&#10;  d.f_count,&#13;&#10;  d.f_in_sum,&#13;&#10;  d.f_in_cnt,&#13;&#10;  (select f_result from SP_T_NSI_PARTNER_INFO_GET(p.f_id,4)) as f_region,&#13;&#10;  (select f_result from SP_T_NSI_PARTNER_INFO_GET(p.f_id,1)) as f_mail,&#13;&#10;  (select f_result from SP_T_NSI_PARTNER_INFO_GET(p.f_id,3)) as f_phone,&#13;&#10;  (select f_result from SP_T_NSI_PARTNER_INFO_GET(p.f_id,2)) as f_fio&#13;&#10;  /*,&#13;&#10;  sum(d.f_doc_sum),&#13;&#10;  sum(d.f_doc_count)&#13;&#10;  */&#13;&#10;from&#13;&#10;  t_nsi_partner p&#13;&#10;  left join (&#13;&#10;    select d.f_partner,&#13;&#10;        sum(coalesce(pr.f_cnt,s.f_cnt)*s.f_price_val) f_sum,&#13;&#10;        sum(pr.f_cnt) f_count,sum(coalesce(pr.f_cnt,0)*pp.f_price) as f_in_sum,&#13;&#10;        sum(coalesce(pr.f_cnt,0)) f_in_cnt&#13;&#10;    from&#13;&#10;      t_doc_out d&#13;&#10;      inner join t_doc_out_str s on d.f_id=s.f_doc_out&#13;&#10;      inner join T_DOC_OUT_STR_PARTY pr on s.f_id=pr.f_doc_out_str&#13;&#10;      inner join t_nsi_good_party pp on pr.f_party=pp.f_id&#13;&#10;      inner join t_nsi_goods g on g.f_id=s.f_good&#13;&#10;    where&#13;&#10;      d.f_date between :st_date and :en_date&#13;&#10;      and d.f_state&#62;=3&#13;&#10;      and (g.f_partner=:f_partner&#13;&#10;      or -1=:f_partner)&#13;&#10;    group by d.f_partner&#13;&#10;  )  d on p.f_id=d.f_partner&#13;&#10;order by f_region,f_name" PropData="05704C656674027C0470546F7002140A506172616D657465727301010640204E616D653D2273745F64617465222044617461547970653D22667444617465222045787072657373696F6E3D22262336303B73745F64617465262336323B2200010640204E616D653D22656E5F64617465222044617461547970653D22667444617465222045787072657373696F6E3D22262336303B65645F64617465262336323B2200010644204E616D653D22665F706172746E6572222044617461547970653D226674496E7465676572222045787072657373696F6E3D22262336303B665F706F7374262336323B2200010644204E616D653D22665F706172746E6572222044617461547970653D226674496E7465676572222045787072657373696F6E3D22262336303B665F706F7374262336323B220000"/>
  </TfrxDataPage>
  <TfrxDialogPage Name="DialogPage1" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Tahoma" Font.Style="0" BorderStyle="bsDialog" DoubleBuffered="False" Height="188" ClientHeight="150" Left="1069" Top="432" Width="226" Scaled="True" ClientWidth="210" OnShow="DialogPage1OnShow">
    <TfrxDateEditControl Name="DtStart" Left="8" Top="24" Width="89" Height="21" ShowHint="True" Color="-16777211" Date="40427,7998055903" Time="40427,7998055903" WeekNumbers="False"/>
    <TfrxDateEditControl Name="DtEnd" Left="124" Top="24" Width="81" Height="21" ShowHint="True" Color="-16777211" Date="40427,7999193403" Time="40427,7999193403" WeekNumbers="False"/>
    <TfrxLabelControl Name="Label1" Left="8" Top="4" Width="37" Height="13" ShowHint="True" Caption="Начало" Color="-16777201"/>
    <TfrxLabelControl Name="Label2" Left="124" Top="4" Width="56" Height="13" ShowHint="True" Caption="Окончание" Color="-16777201"/>
    <TfrxButtonControl Name="Button1" Left="8" Top="116" Width="91" Height="25" ShowHint="True" Caption="Сформировать" ModalResult="1" OnClick="Button1OnClick"/>
    <TfrxButtonControl Name="Button2" Left="116" Top="116" Width="91" Height="25" ShowHint="True" Caption="Отмена" ModalResult="2"/>
    <TfrxDBLookupComboBox Name="LkpPost" Left="8" Top="64" Width="197" Height="21" ShowHint="True" DataSet="dsPostav" DataSetName="dsPostav" ListField="F_NAME" KeyField="GRP_ID" DropDownWidth="0" DropDownRows="7"/>
    <TfrxCheckBoxControl Name="CheckHide" Left="12" Top="96" Width="189" Height="17" ShowHint="True" Caption="Скрыть контакты" Color="-16777201"/>
  </TfrxDialogPage>
  <TfrxReportPage Name="Page1" PaperWidth="210" PaperHeight="297" PaperSize="9" LeftMargin="5" RightMargin="5" TopMargin="5" BottomMargin="5" ColumnWidth="0" ColumnPositions.Text="" Frame.Typ="0" HGuides.Text="" VGuides.Text="">
    <TfrxReportTitle Name="ReportTitle1" FillType="ftBrush" FillGap.Top="0" FillGap.Left="0" FillGap.Bottom="0" FillGap.Right="0" Frame.Typ="0" Height="60,47248" Left="0" Top="18,89765" Width="755,906">
      <TfrxMemoView Name="Memo1" Align="baWidth" Left="0" Top="11,33859" Width="755,906" Height="37,7953" Font.Charset="1" Font.Color="-16777208" Font.Height="-16" Font.Name="Arial" Font.Style="1" Frame.Typ="0" HAlign="haCenter" ParentFont="False" Text="Отчет о продажах за период с [DateToStr(&#60;St_date&#62;)] по [DateToStr(&#60;Ed_date&#62;)] [IIF(&#60;f_post&#62;&#62;0,' по поставщику: '+&#60;dsPostav.&#34;F_NAME&#34;&#62;,'')]"/>
    </TfrxReportTitle>
    <TfrxGroupHeader Name="GroupHeader1" FillType="ftBrush" FillGap.Top="0" FillGap.Left="0" FillGap.Bottom="0" FillGap.Right="0" Frame.Typ="0" Height="18,89765" Left="0" Top="185,19697" Width="755,906" Condition="dsResult.&#34;F_REGION&#34;">
      <TfrxMemoView Name="Memo2" Left="3,77953" Top="0" Width="801,26036" Height="18,89765" DataField="F_REGION" DataSet="FIBQuery1" DataSetName="dsResult" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="0" Fill.BackColor="15790320" ParentFont="False" Text="[dsResult.&#34;F_REGION&#34;]"/>
    </TfrxGroupHeader>
    <TfrxMasterData Name="MasterData1" FillType="ftBrush" FillGap.Top="0" FillGap.Left="0" FillGap.Bottom="0" FillGap.Right="0" Frame.Typ="0" Height="56,69295" Left="0" Top="226,7718" Width="755,906" ColumnWidth="0" ColumnGap="0" DataSet="FIBQuery1" DataSetName="dsResult" RowCount="0" Stretched="True">
      <TfrxMemoView Name="Memo3" Left="3,77953" Top="0" Width="461,10266" Height="18,89765" DataField="F_NAME" DataSet="FIBQuery1" DataSetName="dsResult" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="7" ParentFont="False" Text="[dsResult.&#34;F_NAME&#34;]"/>
      <TfrxMemoView Name="Memo4" Left="3,77953" Top="18,89765" Width="461,10266" Height="18,89765" DataSet="FIBQuery1" DataSetName="dsResult" Font.Charset="1" Font.Color="-16777208" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="1" ParentFont="False" Text="[IIF(&#60;hide_info&#62;,'',&#60;dsResult.&#34;F_U_ADDRES&#34;&#62;)]"/>
      <TfrxMemoView Name="Memo5" Left="3,77953" Top="37,7953" Width="185,19697" Height="18,89765" StretchMode="smMaxHeight" DataSet="FIBQuery1" DataSetName="dsResult" Font.Charset="1" Font.Color="-16777208" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="9" ParentFont="False" Text="[IIF(&#60;hide_info&#62;,'',&#60;dsResult.&#34;F_MAIL&#34;&#62;)]"/>
      <TfrxMemoView Name="Memo6" Left="188,9765" Top="37,7953" Width="151,1812" Height="18,89765" StretchMode="smMaxHeight" DataSet="FIBQuery1" DataSetName="dsResult" Font.Charset="1" Font.Color="-16777208" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="8" ParentFont="False" Text="[IIF(&#60;hide_info&#62;,'',&#60;dsResult.&#34;F_PHONE&#34;&#62;)]"/>
      <TfrxMemoView Name="Memo7" Left="340,1577" Top="37,7953" Width="124,72449" Height="18,89765" StretchMode="smMaxHeight" DataSet="FIBQuery1" DataSetName="dsResult" Font.Charset="1" Font.Color="-16777208" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="8" ParentFont="False" Text="[IIF(&#60;hide_info&#62;,'',&#60;dsResult.&#34;F_FIO&#34;&#62;)]"/>
      <TfrxMemoView Name="Memo8" Left="464,88219" Top="0" Width="83,14966" Height="56,69295" StretchMode="smMaxHeight" DataField="F_COUNT" DataSet="FIBQuery1" DataSetName="dsResult" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[dsResult.&#34;F_COUNT&#34;]"/>
      <TfrxMemoView Name="Memo9" Left="548,03185" Top="0" Width="102,04731" Height="56,69295" StretchMode="smMaxHeight" DataSet="FIBQuery1" DataSetName="dsResult" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[dsResult.&#34;F_IN_SUM&#34;]"/>
      <TfrxMemoView Name="Memo12" Left="650,07916" Top="0" Width="102,04731" Height="56,69295" StretchMode="smMaxHeight" DataField="F_SUM" DataSet="FIBQuery1" DataSetName="dsResult" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[dsResult.&#34;F_SUM&#34;]"/>
    </TfrxMasterData>
    <TfrxGroupFooter Name="GroupFooter1" FillType="ftBrush" FillGap.Top="0" FillGap.Left="0" FillGap.Bottom="0" FillGap.Right="0" Frame.Typ="0" Height="18,89765" Left="0" Top="306,14193" Width="755,906">
      <TfrxMemoView Name="Memo10" Left="3,77953" Top="0" Width="461,10266" Height="18,89765" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" ParentFont="False" Text="Итого по региону [dsResult.&#34;F_REGION&#34;]"/>
      <TfrxSysMemoView Name="SysMemo1" Left="464,88219" Top="0" Width="83,14966" Height="18,89765" DisplayFormat.DecimalSeparator="." DisplayFormat.FormatStr="%2.2n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haRight" ParentFont="False" Text="[SUM(&#60;dsResult.&#34;F_COUNT&#34;&#62;,MasterData1)]"/>
      <TfrxSysMemoView Name="SysMemo2" Left="548,03185" Top="0" Width="102,04731" Height="18,89765" DisplayFormat.DecimalSeparator="." DisplayFormat.FormatStr="%2.2n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haRight" ParentFont="False" Text="[SUM(&#60;dsResult.&#34;F_IN_SUM&#34;&#62;,MasterData1)]"/>
      <TfrxSysMemoView Name="SysMemo8" Left="650,07916" Top="0" Width="102,04731" Height="18,89765" DisplayFormat.DecimalSeparator="." DisplayFormat.FormatStr="%2.2n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haRight" ParentFont="False" Text="[SUM(&#60;dsResult.&#34;F_SUM&#34;&#62;,MasterData1)]"/>
    </TfrxGroupFooter>
    <TfrxHeader Name="Header1" FillType="ftBrush" FillGap.Top="0" FillGap.Left="0" FillGap.Bottom="0" FillGap.Right="0" Frame.Typ="0" Height="22,67718" Left="0" Top="139,84261" Width="755,906">
      <TfrxSysMemoView Name="SysMemo3" Left="464,88219" Top="3,77953" Width="83,14966" Height="18,89765" DisplayFormat.DecimalSeparator="." DisplayFormat.FormatStr="%2.2n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" Text="Количество"/>
      <TfrxSysMemoView Name="SysMemo4" Left="548,03185" Top="3,77953" Width="102,04731" Height="18,89765" DisplayFormat.DecimalSeparator="." DisplayFormat.FormatStr="%2.2n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" Text="Сумма 1"/>
      <TfrxSysMemoView Name="SysMemo9" Left="650,07916" Top="3,77953" Width="102,04731" Height="18,89765" DisplayFormat.DecimalSeparator="." DisplayFormat.FormatStr="%2.2n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" Text="Сумма 2"/>
    </TfrxHeader>
    <TfrxFooter Name="Footer1" FillType="ftBrush" FillGap.Top="0" FillGap.Left="0" FillGap.Bottom="0" FillGap.Right="0" Frame.Typ="0" Height="22,67718" Left="0" Top="347,71676" Width="755,906">
      <TfrxMemoView Name="Memo11" Left="3,77953" Top="0" Width="461,10266" Height="18,89765" Font.Charset="1" Font.Color="-16777208" Font.Height="-15" Font.Name="Arial" Font.Style="1" Frame.Typ="15" ParentFont="False" Text="Общий итог"/>
      <TfrxSysMemoView Name="SysMemo5" Left="464,88219" Top="0" Width="83,14966" Height="18,89765" DisplayFormat.DecimalSeparator="." DisplayFormat.FormatStr="%2.2n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="-16777208" Font.Height="-15" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haRight" ParentFont="False" Text="[SUM(&#60;dsResult.&#34;F_COUNT&#34;&#62;,MasterData1)]"/>
      <TfrxSysMemoView Name="SysMemo6" Left="548,03185" Top="0" Width="102,04731" Height="18,89765" DisplayFormat.DecimalSeparator="." DisplayFormat.FormatStr="%2.2n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="-16777208" Font.Height="-15" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haRight" ParentFont="False" Text="[SUM(&#60;dsResult.&#34;F_IN_SUM&#34;&#62;,MasterData1)]"/>
      <TfrxSysMemoView Name="SysMemo10" Left="650,07916" Top="0" Width="102,04731" Height="18,89765" DisplayFormat.DecimalSeparator="." DisplayFormat.FormatStr="%2.2n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="-16777208" Font.Height="-15" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haRight" ParentFont="False" Text="[SUM(&#60;dsResult.&#34;F_SUM&#34;&#62;,MasterData1)]"/>
    </TfrxFooter>
    <TfrxPageFooter Name="PageFooter1" FillType="ftBrush" FillGap.Top="0" FillGap.Left="0" FillGap.Bottom="0" FillGap.Right="0" Frame.Typ="0" Height="22,67718" Left="0" Top="430,86642" Width="755,906">
      <TfrxSysMemoView Name="SysMemo7" Left="646,29963" Top="0" Width="109,60637" Height="18,89765" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="0" HAlign="haRight" ParentFont="False" Text="[PAGE#]"/>
    </TfrxPageFooter>
  </TfrxReportPage>
</TfrxReport>
